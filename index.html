<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<title>å¤§ç‰† ARï½œå®˜æ–¹æ¥µç°¡éŒ¨é»žæ¸¬è©¦</title>

<!-- å®˜æ–¹å»ºè­°ç‰ˆæœ¬ï¼šA-Frame 1.6.0 + mind-ar 1.2.5 -->
<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
  html,body{
    margin:0;
    height:100%;
    overflow:hidden;
    background:#000;
    color:#0f0;
    font-family:monospace;
  }
  #tfBadge{
    position:fixed;
    right:12px;
    top:12px;
    z-index:10;
    background:#29b6f6;
    color:#000;
    padding:6px 10px;
    border-radius:8px;
    display:none;
    font-weight:bold;
  }
  #log{
    position:fixed;
    left:8px;
    bottom:8px;
    right:8px;
    height:110px;
    overflow:auto;
    background:rgba(0,0,0,.6);
    padding:8px;
    z-index:10;
    font-size:11px;
    line-height:1.25;
  }
</style>
</head>
<body>
<div id="tfBadge">ðŸŽ¯ targetFound</div>
<div id="log"></div>

<a-scene
  mindar-image="imageTargetSrc: ./wall-anchor.mind?v=20251113;"
  color-space="sRGB"
  renderer="colorManagement: true; physicallyCorrectLights: true"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

  <a-assets timeout="30000">
    <!-- ä½ çš„å½±ç‰‡ -->
    <video id="vid" src="./video.mp4"
           preload="auto"
           playsinline webkit-playsinline
           muted
           crossorigin="anonymous"></video>
  </a-assets>

  <!-- ç›¸æ©Ÿï¼ˆå®˜æ–¹ç¯„ä¾‹å¯«æ³•ï¼‰ -->
  <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

  <!-- åªæœ‰ä¸€å€‹éŒ¨é»žï¼štargetIndex:0 -->
  <a-entity id="marker" mindar-image-target="targetIndex:0">
    <a-plane id="plane"
      position="0 0 0"
      width="0.8" height="0.4"
      material="shader:flat; src:#vid; side:double; transparent:true; alphaTest:0.01">
    </a-plane>
  </a-entity>

</a-scene>

<script>
const logEl = document.getElementById('log');
const log = s => { console.log(s); logEl.textContent += s + "\n"; logEl.scrollTop = logEl.scrollHeight; };

const v = document.getElementById('vid');
const marker = document.getElementById('marker');
const badge = document.getElementById('tfBadge');

/* è¡Œå‹•è£ç½®ï¼šé»žä¸€ä¸‹è®“å½±ç‰‡æœ‰æ’­æ”¾æ¬Šé™ */
function tryPlay(){ v.play().catch(()=>{}); }
['loadeddata','canplay'].forEach(ev => v.addEventListener(ev, tryPlay, {once:true}));
window.addEventListener('pointerdown', tryPlay, {once:true});
window.addEventListener('touchstart', tryPlay, {once:true, passive:true});

/* éŒ¨é»žäº‹ä»¶ */
marker.addEventListener('targetFound', () => {
  badge.style.display = 'block';
  log('ðŸŽ¯ targetFound (index 0)');
  v.play().catch(()=>{});
});
marker.addEventListener('targetLost', () => {
  badge.style.display = 'none';
  log('âš  targetLost (index 0)');
});
</script>
</body>
</html>
